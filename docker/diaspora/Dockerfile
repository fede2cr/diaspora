FROM debian:jessie

RUN apt-get update && apt-get upgrade -y && apt-get install -y cmake build-essential libgmp-dev libssl-dev libcurl4-openssl-dev libxml2-dev libxslt-dev imagemagick ghostscript git curl libpq-dev libmagickwand-dev nodejs gawk libreadline6-dev libyaml-dev libsqlite3-dev sqlite3 autoconf libgdbm-dev libncurses5-dev automake bison libffi-dev

RUN adduser --gecos "" --disabled-login --uid 994 diaspora

RUN mkdir /home/diaspora/diaspora && chown diaspora:diaspora /home/diaspora/diaspora

COPY run_as_diaspora.sh /run_as_diaspora.sh

COPY docker-entrypoint.sh /docker-entrypoint.sh

VOLUME /config

ENTRYPOINT ["/docker-entrypoint.sh"]

CMD ["run"]
