<VirtualHost *:443>
  ServerName docker.diaspora.koehn.com
  DocumentRoot /var/www/diaspora/public

  SSLEngine On

  RewriteEngine On

  RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
  RewriteRule ^/(.*)$ balancer://upstream%{REQUEST_URI} [P,QSA,L]

  <Proxy balancer://upstream>
    BalancerMember http://diaspora:3000
  </Proxy>

  ProxyRequests Off
  ProxyVia On
  ProxyPreserveHost On
  RequestHeader set X_FORWARDED_PROTO https
  CustomLog ${APACHE_LOG_DIR}/diaspora.log combined

  ErrorLog ${APACHE_LOG_DIR}/diaspora_error.log

  <Proxy *>
    Require all granted 
  </Proxy>

  <Directory /var/www/diaspora/public>
    Require all granted
    AllowOverride all
    Options -MultiViews
  </Directory>

	SSLEngine on
	SSLProtocol all -SSLv2 -SSLv3
	SSLHonorCipherOrder On
	SSLCompression off
	SSLCipherSuite "HIGH:!aNULL:!MD5:!3DES:!CAMELLIA:!AES128"
	SSLHonorCipherOrder on
	SSLUseStapling on

  SSLCertificateFile /etc/ssl/certs/foo.pem
  SSLCertificateKeyFile /etc/ssl/private/foo.key
  SSLCertificateChainFile /etc/ssl/certs/sub.class1.server.ca.pem

  Header set Strict-Transport-Security "max-age=1607040400; includeSubDomains"
</VirtualHost>
